env = LIBVA_DRIVER_NAME,nvidia
env = __GLX_VENDOR_LIBRARY_NAME,nvidia

# Enables VRR on fullscreen apps
monitor=DP-4,2560x1440@180,0x0,1,vrr,2

# Variables
$mainMod = SUPER
$term = alacritty
$browser = firefox

# -----------------------------------------------------------------------------
# AUTOSTART
# -----------------------------------------------------------------------------
# Status Bar
exec-once = waybar

# Wallpaper
exec-once = hyprpaper

# Notifications
exec-once = $HOME/.local/bin/start-dunst.sh

# Authentication Agent (Essential for GUI apps needing sudo)
# exec-once = /usr/lib/polkit-kde-authentication-agent-1 # Adjust path based on your distro

# No silent to give firefox focus on boot, rest should not take focus. I always
# hated this on windows and macos, bunch of applications battling for focus
# during boot.
exec-once = [workspace 1] firefox --name firefox-main -P default-release

# Application Autostart (Matching your i3 setup)
exec-once = [workspace 2 silent] alacritty --class term-main
exec-once = [workspace 3 silent] keepassxc
exec-once = [workspace 4 silent] discord
# exec-once = [workspace 5 silent] spotify
exec-once = [workspace 6 silent] steam

# Firefox Private (Scratchpad)
# exec-once = firefox -private-window --class firefox-private -P private
# Scratchpad Terminal
# exec-once = alacritty --class scratch-term

# -----------------------------------------------------------------------------
# APPEARANCE
# -----------------------------------------------------------------------------
general {
    gaps_in = 10
    gaps_out = 10
    border_size = 2

    # Dracula Colors
    col.active_border = rgb(8BE9FD)
    col.inactive_border = rgb(282A36)

    layout = dwindle
}

decoration {
    rounding = 5

    blur {
        enabled = true
        size = 3
        passes = 1
    }
}

# TODO(tatu): I need to make a separate layout for gaming. Having capslock as
# escape is perfect during development, but during gaming I constantly butter
# finger capslock. Either map it here or check if I can just remap it at
# keyboard level.
input {
    kb_layout = fi

    # Capslock to escape without any annoying switch of them
    kb_options = caps:escape

    # Disable mouse acceleration
    accel_profile=flat
}

cursor {
  # Hardware cursors don't work on nvidia, I don't know why.
  no_hardware_cursors = 1
}

dwindle {
    # This roughly mimics "split" behavior
    pseudotile = yes
    preserve_split = yes
}

# -----------------------------------------------------------------------------
# WINDOW RULES (Assigns & Behavior)
# -----------------------------------------------------------------------------
# Workspace assignments
windowrule = workspace 2, match:class ^(alacritty)$, match:title ^(term-main)$
windowrule = workspace 3, match:class ^(org.keepassxc.KeePassXC)$
windowrule = workspace 4, match:class ^(discord)$
windowrule = workspace 1, match:class ^(firefox-main)$
windowrule = workspace 5, match:class ^(Spotify)$
windowrule = workspace 6, match:class ^(steam)$
windowrule = workspace 6, match:initial_title ^(Friends List)$

# Steam Games to Workspace 7 (Present)
windowrule = workspace 7, match:class ^steam_app_\d+$

# Scratchpads (Special Workspaces)
# In Hyprland, scratchpads are "special workspaces".
# We define rules to send these apps to specific special workspaces on launch.

# Scratch Terminal
windowrule = float on, match:class ^(scratch-term)$
windowrule = workspace special:scratch_term, match:class ^(scratch-term)$
windowrule = center on, match:class ^(scratch-term)$
windowrule = size 80% 80%, match:class ^(scratch-term)$

# Private Firefox
windowrule = float on, match:class ^(firefox-private)$
windowrule = workspace special:firefox_private, match:class ^(firefox-private)$
windowrule = center on, match:class ^(firefox-private)$
windowrule = size 80% 80%, match:class ^(firefox-private)$

windowrule = tile on, match:class ^(rusty-path-of-building)$ # Force tile

# -----------------------------------------------------------------------------
# KEYBINDINGS
# -----------------------------------------------------------------------------

# App Shortcuts
# bind = $mainMod, Return, exec, i3-sensible-terminal # Or just alacritty
bind = $mainMod SHIFT, Q, killactive
bind = $mainMod, Space, exec, toggle-rofi

# Vim Focus
bind = $mainMod, H, movefocus, l
bind = $mainMod, J, movefocus, d
bind = $mainMod, K, movefocus, u
bind = $mainMod, L, movefocus, r

# Vim Move Window
bind = $mainMod SHIFT, H, movewindow, l
bind = $mainMod SHIFT, J, movewindow, d
bind = $mainMod SHIFT, K, movewindow, u
bind = $mainMod SHIFT, L, movewindow, r

# Layout Toggles
bind = $mainMod, O, togglesplit # Split horizontal/vertical toggle
bind = $mainMod, F, fullscreen
bind = $mainMod, S, togglegroup # Tabbed-like behavior
# Note: Stacked layout isn't strictly available in Dwindle, use Master layout if preferred.

# Screenshots (Flameshot or Grim/Slurp)
bind = $mainMod, Print, exec, flameshot gui -p ~/Images/Screenshots

# Workspaces (1-7)
bind = $mainMod, 1, workspace, 1
bind = $mainMod, 2, workspace, 2
bind = $mainMod, 3, workspace, 3
bind = $mainMod, 4, workspace, 4
bind = $mainMod, 5, workspace, 5
bind = $mainMod, 6, workspace, 6
bind = $mainMod, 7, workspace, 7

# Move to Workspace
bind = $mainMod SHIFT, 1, movetoworkspace, 1
bind = $mainMod SHIFT, 2, movetoworkspace, 2
bind = $mainMod SHIFT, 3, movetoworkspace, 3
bind = $mainMod SHIFT, 4, movetoworkspace, 4
bind = $mainMod SHIFT, 5, movetoworkspace, 5
bind = $mainMod SHIFT, 6, movetoworkspace, 6
bind = $mainMod SHIFT, 7, movetoworkspace, 7

# Scratchpad Toggles
# bind = $mainMod, P, togglespecialworkspace, scratch_term
# bind = $mainMod, I, togglespecialworkspace, firefox_private

# Reload/Exit
bind = $mainMod SHIFT, C, exec, hyprctl reload
bind = $mainMod SHIFT, R, exec, hyprctl reload # Hyprland reloads instantly, no restart needed

# Modes

# Emulate i3/vim marks
bind = $mainMod, G, submap, mark_mode
submap = mark_mode
bind = , J, focuswindow, class:^(firefox-main)$
bind = , J, submap, reset
bind = , K, focuswindow, class:^(term-main)$
bind = , K, submap, reset
bind = , L, focuswindow, class:^(discord)$
bind = , L, submap, reset
bind = , odiaeresis, focuswindow, class:^(Spotify)$ # 'รถ' key
bind = , odiaeresis, submap, reset
bind = , U, focuswindow, class:^(KeePassXC)$
bind = , U, submap, reset
bind = , O, focuswindow, class:^(steam)$
bind = , O, submap, reset
bind = , I, focuswindow, title:^(Friends List)$
bind = , I, submap, reset
bind = , catchall, submap, reset
submap = reset

# Thanks to samsaffron for this stealable gem used in his i3 config
bind = $mainMod, X, submap, exit_mode
submap = exit_mode
bind = , l, exit,
bind = , r, exec, systemctl reboot
bind = , s, exec, systemctl poweroff
bind = , catchall, submap, reset
submap = reset
